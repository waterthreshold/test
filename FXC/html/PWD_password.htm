<html>
<head>
<title>W6B-T223-001</title>
<meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
<link href="css/new_custom.css" rel="stylesheet" type="text/css">
<script src="jquery.js"></script>
<script src="script/script.js"></script>
</head>

<body class="page-body">
<div class="container-fluid frame-content" id="frame-content">
    <form id="target"  method="POST" action="SetPWD.cgi">
        <input type="hidden" name="buttonHit">
        <input type="hidden" name="buttonValue">
        <div class="row">
            <div class="col-md-12">
                <div class="card card-notify card-yellow">
                    <div class="card-collapse">
                        <div class="card-header card-flex">
                            <div class="card-title">We recommend that your password meets the following conditions:</div>
                            <div class="card-margin-left">
                                <button type="button" value="More" name="More" class="btn pull-right btn-more" href="#more">More</button>
                            </div>
                        </div>
                        <div id="more" style="display:none;">
                            <div class="card-body">

                                <p class="card-hit">Contains 6 to 32 characters</p>
                                <p class="card-hit">Contains no more than two identical characters in a row</p>
                                <p class="card-hit">At least one uppercase character</p>
                                <p class="card-hit">At least one lowercase character</p>
                                <p class="card-hit">At least one number</p>
                                <p class="card-hit">At least one special character, such as @#&...</p>

                            </div>
                            <div class="card-bottom">
                            </div>
                        </div>
                        
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">To change the password</div>
                    </div>
                    <div class="card-body">
                        <div class="mui-textfield">
                            <input id="sys_old_passwd" type="password" class="form-control" name="sysOldPasswd" maxlength="32" oninput="enable_apply_button()">
                            <label tabindex="-1">Old Password</label>
                        </div>
                        <div class="mui-textfield">
                            <input id="sys_new_passwd" type="password" class="form-control" name="sysNewPasswd" maxlength="32" oninput="enable_apply_button()">
                            <label tabindex="-1">Set Password</label>
                        </div>
                        <div class="mui-textfield">
                            <input id="sys_confirm_passwd" type="password" class="form-control" name="sysConfirmPasswd" maxlength="130" oninput="enable_apply_button()">
                            <label tabindex="-1">Repeat New Password</label>
                        </div>
                    </div>
                    <div class="card-bottom">

                        <button id="apply" value="Apply" onClick="buttonClick(this,'Apply');return checkData()" type="SUBMIT" name="cfAlert_Apply" class="btn btn-primary pull-right btn-round" disabled>Apply</button>

                    </div>
                </div>
            </div>
        </div>

        <script language="javascript" type="text/javascript">
            document.open();
            document.write("<input type=\"hidden\" name=\"timestamp_value\" value=\"");
            var timestamp = new Date();
            document.write(timestamp);
            document.write("\">");
            document.close();
        </script>

        <input type="hidden" name="answer1_changed" value="">
        <input type="hidden" name="answer2_changed" value="">
    </form>
</div>
</body>

<script>
var timer;
var timeout = 1000;

$(document).ready(function()
{
    $("#target").submit(function(e) {
	e.preventDefault();
		if (checkData()) {
			buttonFilter();
			
			var formdata = {
				sysOldPasswd:$('#sys_old_passwd').val(),
				sysNewPasswd:$('#sys_new_passwd').val()
			
			};
			$.ajax({
				type: "POST",
				url: $('#target').attr('action'), 
				contentType: "application/json",
				data: JSON.stringify(formdata),
				dataType: "json",
				success: function(response) {
				  console.log("Success:", response);
				},
				error: function(error) {
				  console.error("Error:", error);
				}
			});
			
		}
		location.reload()
    });
	
    $('.card-collapse .btn-more').live("click", function(ev) {
        var href = $(this).attr("href");
        $(href).slideDown();
        $(this).css("visibility", "hidden");
        ev.preventDefault();
    });
});

function buttonFilter()
{
    var buttonElements;

    buttonElements=document.getElementsByTagName('button');
    var i;
    for(i=0;i<buttonElements.length;i++)
    {
        if(buttonElements[i].type=='submit' || buttonElements[i].type=='button'|| buttonElements[i].type=='reset')
        {
            if((buttonElements[i].value!=document.forms[0].buttonHit.name))
                buttonElements[i].disabled=1;
            else
            {
                var name;
                name=buttonElements[i].name;
                buttonElements[i].name='NoUse';
                buttonElements[i].disabled=1;
                document.forms[0].buttonValue.name=name;
                document.forms[0].buttonHit.disabled=1;
            }
        }
    }
}

function buttonClick(btn,value)
{
    document.forms[0].buttonHit.value=btn.name;
    document.forms[0].buttonValue.value=value;
    return true;
}

function checkData()
{
    var cf = document.forms[0];
    var msg = "";
    if(cf.sysNewPasswd.value.length >= 1 || cf.sysConfirmPasswd.value.length >= 1)
    {
        if(cf.sysNewPasswd.value != cf.sysConfirmPasswd.value)
        {
            msg+= "The password you typed does not match. Please enter it again.";
            cf.sysConfirmPasswd.focus();
        }
        else if((cf.sysNewPasswd.value == "password") || (cf.sysConfirmPasswd.value == "password"))
        {

            alert("You cannot use the default admin password. You must change the admin password.");

            return false;
        }
        else if(cf.sysNewPasswd.value.length < 6)
        {
            alert("Minimum login password length must be 6");
            return false;
        }
        else if(cf.sysNewPasswd.value.length > 32)
        {
            alert("Max login password length must be 32");
            return false;
        }
    }
    else if((cf.sysNewPasswd.value.length == 0) || (cf.sysConfirmPasswd.value.length == 0))
    {

        alert("You must enter a password.");

        return false;
    }

    if (msg.length > 1)
    {
        alert(msg);
        return false;
    }

    return true;
}

function timestamp(){
    var timestamp = new Date();
    document.write(timestamp);
    return true;
}

function enable_apply_button()
{
    var cf = document.forms[0]; 
    cf.cfAlert_Apply.disabled = false;
}
</script>
</html>

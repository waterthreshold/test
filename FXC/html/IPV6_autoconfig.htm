<html>
<head>
<title>W6B-T223-001</title>
<meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport">
<link href="css/new_custom.css" rel="stylesheet" type="text/css">
<script src="jquery.js"></script>
<script src="script/script.js"></script>
<script src="func.js"></script>
<script src="utility.js"></script>
</head>

<body onload="loadSettings();" class="page-body">
<div class="container-fluid frame-content" id="frame-content">
    <form id="target" name="formname" method="POST" action="ipv6_autoconfig.cgi">
        <input type="hidden" name="buttonHit">
        <input type="hidden" name="buttonValue">
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <div class="row">
                            <div class="col-md-3">
                                <ul class="nav nav-pills flex-column">
                                    <li class="nav-item" onclick="window.location.href='IPV6_disable.htm'">
                                        <a class="nav-link">Disabled</a>
                                    </li>
                                    <li class="nav-item" onclick="window.location.href='IPV6_auto.htm'">
                                        <a class="nav-link">Auto Detect</a>
                                    </li>
                                    <li class="nav-item" onclick="window.location.href='IPV6_tunnel.htm'">
                                        <a class="nav-link">6to4 Tunnel</a>
                                    </li>
                                    <li class="nav-item" onclick="window.location.href='IPV6_passthrough.htm'">
                                        <a class="nav-link">Pass Through</a>
                                    </li>
                                    <li class="nav-item" onclick="window.location.href='IPV6_fixed.htm'">
                                        <a class="nav-link">Fixed</a>
                                    </li>
                                    <li class="nav-item" onclick="window.location.href='IPV6_dhcp.htm'">
                                        <a class="nav-link">DHCP</a>
                                    </li>
                                    <li class="nav-item" onclick="window.location.href='IPV6_pppoe.htm'">
                                        <a class="nav-link">PPPoE</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link active">Auto Config</a>
                                    </li>
                                    <li class="nav-item" onclick="window.location.href='IPV6_6rd.htm'">
                                        <a class="nav-link">6rd</a>
                                    </li>
                                </ul>
                            </div>
                            <div class="col-md-10">
                                <div class="card-body">
                                    <div class="card-title p-d-20">Auto Config Setup</div>
                                    <div class="mui-textfield">
                                        <input class="form-control" id="ipv6_system" type="text" name="ipv6_system" maxlength="63" value="NVRAM_ipv6_system_name_auto">
                                        <label tabindex="-1">DHCP User Class (if Required)</label>
                                    </div>
                                    <div class="mui-textfield">
                                        <input class="form-control" id="domain_name" type="text" name="domain_name" maxlength="60" value="NVRAM_ipv6_domain_name_auto">
                                        <label tabindex="-1">DHCP Domain Name (if Required)</label>
                                    </div>
                                    <div class="card-divider"></div>
                                    <div class="card-title p-d-20">IPv6 Domain Name Server (DNS) Address</div>
                                    <div class="form-check form-check-radio">
                                        <label class="form-check-label">
                                            <input class="form-check-input" id="dnsassign_auto" type="radio" name="DNSAssign" value="0" onClick="setDNS()">
                                            Get Automatically from ISP
                                            <span class="circle">
                                                <span class="check"></span>
                                            </span>
                                        </label>
                                    </div>
                                    <div class="form-check form-check-radio form-check-next">
                                        <label class="form-check-label">
                                            <input class="form-check-input" id="dnsassign_fixed" type="radio" name="DNSAssign" value="1" onClick="setDNS()">
                                            Use These DNS Servers
                                            <span class="circle">
                                                <span class="check"></span>
                                            </span>
                                        </label>
                                    </div>
                                    <div class="mui-textfield input-ip">
                                        <input id="pdaddr1" type="text" name="PDAddr1" class="form-control" maxlength="4" onFocus="" onkeydown="bscheck(event,this,1)" onkeyup="jumpcheckv6(this,0)">:
                                        <input id="pdaddr2" type="text" name="PDAddr2" class="form-control" maxlength="4" onFocus="" onkeydown="bscheck(event,this,0)" onkeyup="jumpcheckv6(this,0)">:
                                        <input id="pdaddr3" type="text" name="PDAddr3" class="form-control" maxlength="4" onFocus="" onkeydown="bscheck(event,this,0)" onkeyup="jumpcheckv6(this,0)">:
                                        <input id="pdaddr4" type="text" name="PDAddr4" class="form-control" maxlength="4" onFocus="" onkeydown="bscheck(event,this,0)" onkeyup="jumpcheckv6(this,0)">:
                                        <input id="pdaddr5" type="text" name="PDAddr5" class="form-control" maxlength="4" onFocus="" onkeydown="bscheck(event,this,0)" onkeyup="jumpcheckv6(this,0)">:
                                        <input id="pdaddr6" type="text" name="PDAddr6" class="form-control" maxlength="4" onFocus="" onkeydown="bscheck(event,this,0)" onkeyup="jumpcheckv6(this,0)">:
                                        <input id="pdaddr7" type="text" name="PDAddr7" class="form-control" maxlength="4" onFocus="" onkeydown="bscheck(event,this,0)" onkeyup="jumpcheckv6(this,0)">:
                                        <input id="pdaddr8" type="text" name="PDAddr8" class="form-control" maxlength="4" onFocus="" onkeydown="bscheck(event,this,0)" onkeyup="jumpcheckv6(this,1)">
                                        <label tabindex="-1">Primary DNS</label>
                                    </div>
                                    <div class="mui-textfield input-ip">
                                        <input id="sdaddr1" type="text" name="SDAddr1" class="form-control" maxlength="4" onFocus="" onkeydown="bscheck(event,this,1)" onkeyup="jumpcheckv6(this,0)">:
                                        <input id="sdaddr2" type="text" name="SDAddr2" class="form-control" maxlength="4" onFocus="" onkeydown="bscheck(event,this,0)" onkeyup="jumpcheckv6(this,0)">:
                                        <input id="sdaddr3" type="text" name="SDAddr3" class="form-control" maxlength="4" onFocus="" onkeydown="bscheck(event,this,0)" onkeyup="jumpcheckv6(this,0)">:
                                        <input id="sdaddr4" type="text" name="SDAddr4" class="form-control" maxlength="4" onFocus="" onkeydown="bscheck(event,this,0)" onkeyup="jumpcheckv6(this,0)">:
                                        <input id="sdaddr5" type="text" name="SDAddr5" class="form-control" maxlength="4" onFocus="" onkeydown="bscheck(event,this,0)" onkeyup="jumpcheckv6(this,0)">:
                                        <input id="sdaddr6" type="text" name="SDAddr6" class="form-control" maxlength="4" onFocus="" onkeydown="bscheck(event,this,0)" onkeyup="jumpcheckv6(this,0)">:
                                        <input id="sdaddr7" type="text" name="SDAddr7" class="form-control" maxlength="4" onFocus="" onkeydown="bscheck(event,this,0)" onkeyup="jumpcheckv6(this,0)">:
                                        <input id="sdaddr8" type="text" name="SDAddr8" class="form-control" maxlength="4" onFocus="" onkeydown="bscheck(event,this,0)" onkeyup="jumpcheckv6(this,1)">
                                        <label tabindex="-1">Secondary DNS</label>
                                    </div>
                                    <div class="card-divider"></div>
                                    <div class="card-title"></div>
                                    <p><% ipv6_cgi_get_param("ipv6_wan"); %></p>
                                    <div class="card-divider"></div>
                                    <div class="card-title"></div>
                                    <p><% ipv6_cgi_get_param("ipv6_lan"); %></p>
                                    <div class="card-divider"></div>
                                    <div class="card-title p-d-20">LAN Setup</div>
                                    <p>IP Address Assignment</p>
                                    <div class="form-check form-check-radio">
                                        <label class="form-check-label">
                                            <input class="form-check-input" id="ipassign_dhcp" type="radio" name="IpAssign" value="dhcp" <% nvram_match("lan_dhcpsv6_enable","1", checked); %>>
                                            Use DHCP Server
                                            <span class="circle">
                                                <span class="check"></span>
                                            </span>
                                        </label>
                                    </div>
                                    <div class="form-check form-check-radio form-check-next">
                                        <label class="form-check-label">
                                            <input class="form-check-input" id="ipassign_auto" type="radio" name="IpAssign" value="auto" <% nvram_match("lan_dhcpsv6_enable","0", checked); %>>
                                            Auto Config
                                            <span class="circle">
                                                <span class="check"></span>
                                            </span>
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <label class="form-check-label">
                                            <input class="form-check-input" type="checkbox" id="ipassign_ripng" <% nvram_match("ripng_enable", "1", "CHECKED"); %> name="ipassign_ripng" value="">Enable RIPng
                                            <span class="form-check-sign">
                                                <span class="check"></span>
                                            </span>
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <label class="form-check-label">
                                            <input class="form-check-input" id="useInterfaceId" type="checkbox" <% nvram_match("ipv6_interfaceid_enable", "1", "CHECKED"); %> name="useInterfaceId" value="" onclick= "checkInterfaceID();">Use This Interface ID
                                            <span class="form-check-sign">
                                                <span class="check"></span>
                                            </span>
                                        </label>
                                    </div>
                                    <div class="mui-textfield input-ip mui-textfield-next">
                                        <input id="ipv6_interface_id1" type="text" name="IPv6_interface_id1" class="form-control" maxlength="4" value="" onkeydown="bscheck(event,this,1)" onkeyup="jumpcheckv6(this,0)">:
                                        <input id="ipv6_interface_id2" type="text" name="IPv6_interface_id2" class="form-control" maxlength="4" value="" onkeydown="bscheck(event,this,0)" onkeyup="jumpcheckv6(this,0)">:
                                        <input id="ipv6_interface_id3" type="text" name="IPv6_interface_id3" class="form-control" maxlength="4" value="" onkeydown="bscheck(event,this,0)" onkeyup="jumpcheckv6(this,0)">:
                                        <input id="ipv6_interface_id4" type="text" name="IPv6_interface_id4" class="form-control" maxlength="4" value="" onkeydown="bscheck(event,this,0)" onkeyup="jumpcheckv6(this,1)">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-bottom">
                        <div class="pull-right">
                            <button id="refresh" type="reset" value="BUTTON"  onClick="buttonClick(this,'Refresh');location.reload();" name="Refresh" class="btn btn-white btn-mg-15 btn-round">Status Refresh</button>
                            <button id="apply" type="submit" value="SUBMIT"  onClick="buttonClick(this,'Apply');return checkData()" name="apply" class="btn btn-primary btn-mg-15 btn-round">Apply</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <input type="hidden" name="ipv6_interface_id" value="NVRAM_ipv6_interface_id">
        <input type="hidden" name="ipv6_interfaceid_enable" value="">
        <input type="hidden" name="ipv6_ripng_enable" value="">
        <input type="hidden" name="ipv6_proto" value= "autoconfig">
        <input type="hidden" name="ipv6rd_wan_dns_sel" value= "NVRAM_ipv6rd_wan_dns_sel">
        <input type="hidden" name="ipv6rd_wan_dns1_pri" value= "NVRAM_ipv6rd_wan_dns1_pri">
        <input type="hidden" name="ipv6rd_wan_dns1_sec" value= "NVRAM_ipv6rd_wan_dns1_sec">
    </form>
</div>
</body>

<script>
$(document).ready(function()
{
    $("#target").submit(function() {
        buttonFilter();
    });
});

function setDNS()
{
    var cf = document.forms[0];
    var dflag = cf.DNSAssign[0].checked;

    setDisabled(dflag,cf.PDAddr1,cf.PDAddr2,cf.PDAddr3,cf.PDAddr4,cf.PDAddr5,cf.PDAddr6,cf.PDAddr7,cf.PDAddr8);
    setDisabled(dflag,cf.SDAddr1,cf.SDAddr2,cf.SDAddr3,cf.SDAddr4,cf.SDAddr5,cf.SDAddr6,cf.SDAddr7,cf.SDAddr8);
    DisableFixedDNS = dflag;
}

function checkInterfaceID()
{
    var cf = document.forms[0];
    if(!cf.useInterfaceId.checked)
    {
        cf.IPv6_interface_id1.disabled = true;
        cf.IPv6_interface_id2.disabled = true;
        cf.IPv6_interface_id3.disabled = true;
        cf.IPv6_interface_id4.disabled = true;
        
    }
    else
    {
        cf.IPv6_interface_id1.disabled = false;
        cf.IPv6_interface_id2.disabled = false;
        cf.IPv6_interface_id3.disabled = false;
        cf.IPv6_interface_id4.disabled = false;
    }
}

function checkData()
{
    var cf = document.forms[0];
    var msg = "";
    var openvpnEnable = "NVRAM_openvpnActive";
    
    if (cf.ipv6_system.value.match( /[^\x20-\x7E]/ ))
    {
        alert("User Class is not valid; only printable ASCII characters are allowed.");
        return false;
    }
    
    if (cf.domain_name.value.match( /[^\x20-\x7E]/ ))
    {
        alert("Invalid domain name.!");
        return false;
    }
    
    if(cf.DNSAssign[1].checked)
    {
        if (cf.PDAddr1.value == "" && cf.PDAddr2.value == "" &&
            cf.PDAddr3.value == "" && cf.PDAddr4.value == "" &&
            cf.PDAddr5.value == "" && cf.PDAddr6.value == "" &&
            cf.PDAddr7.value == "" && cf.PDAddr8.value == "")
        {
            alert("The Primary DNS Server is not valid;");
            return false;
            //pri_dns = 1;
        }
        else if (checkFiled(cf.PDAddr1) || checkFiled(cf.PDAddr2) ||
                 checkFiled(cf.PDAddr3) || checkFiled(cf.PDAddr4) ||
                 checkFiled(cf.PDAddr5) || checkFiled(cf.PDAddr6) ||
                 checkFiled(cf.PDAddr7) || checkFiled(cf.PDAddr8))
        {
            alert("Primary DNS Server setting is the IPv6 address of the primary DNS server; only hex digits are required.");
            return false;
        }
        else if (checkUnicast(cf.PDAddr1))
        {
            alert("The Primary DNS Server is not valid;it has to be a global unicast address.");
            return false;
        }

        if (cf.SDAddr1.value == "" && cf.SDAddr2.value == "" && 
            cf.SDAddr3.value == "" && cf.SDAddr4.value == "" &&
            cf.SDAddr5.value == "" && cf.SDAddr6.value == "" &&
            cf.SDAddr7.value == "" && cf.SDAddr8.value == "")
        {
            //alert("Please input Second DNS Server IP\n");
            //return false;
            sec_dns=1;
        }
        else if (checkFiled(cf.SDAddr1) || checkFiled(cf.SDAddr2) ||
                 checkFiled(cf.SDAddr3) || checkFiled(cf.SDAddr4) ||
                 checkFiled(cf.SDAddr5) || checkFiled(cf.SDAddr6) ||
                 checkFiled(cf.SDAddr7) || checkFiled(cf.SDAddr8))
        {
            alert("Secondary DNS Server setting is the IPv6 address of the secondary DNS server; only hex digits are required.");
            return false;
        }
        else if (checkUnicast(cf.SDAddr1))
        {
            alert("The Secondary DNS Server is not valid;it has to be a global unicast address.");
            return false;
        }

        cf.ipv6rd_wan_dns1_pri.value = cf.PDAddr1.value+':'+cf.PDAddr2.value+':'+cf.PDAddr3.value+':'+cf.PDAddr4.value+':'+cf.PDAddr5.value+':'+cf.PDAddr6.value+':'+cf.PDAddr7.value+':'+cf.PDAddr8.value;
        cf.ipv6rd_wan_dns1_sec.value = cf.SDAddr1.value+':'+cf.SDAddr2.value+':'+cf.SDAddr3.value+':'+cf.SDAddr4.value+':'+cf.SDAddr5.value+':'+cf.SDAddr6.value+':'+cf.SDAddr7.value+':'+cf.SDAddr8.value;

        if ((pri_dns != 1) && (sec_dns != 1))
        {
            if (isIPv6Equals(cf.ipv6rd_wan_dns1_pri.value, cf.ipv6rd_wan_dns1_sec.value))
            {
                alert("The Primary DNS Server has to be different from Secondary DNS Server.");
                return false;
            }
        }
    }

    if (cf.useInterfaceId.checked)
        cf.ipv6_interfaceid_enable.value = 1;
    else
        cf.ipv6_interfaceid_enable.value = 0;   

    if (cf.ipassign_ripng.checked)
        cf.ipv6_ripng_enable.value = 1;
    else
        cf.ipv6_ripng_enable.value = 0; 

    if (cf.useInterfaceId.checked)  
    {
        if(cf.IPv6_interface_id1.value.length<=0 || cf.IPv6_interface_id2.value.length<=0 || cf.IPv6_interface_id3.value.length<=0 || cf.IPv6_interface_id4.value.length<=0
           || !(isHex(cf.IPv6_interface_id1.value) && isHex(cf.IPv6_interface_id2.value) && isHex(cf.IPv6_interface_id3.value) && isHex(cf.IPv6_interface_id4.value)))
        {
            msg+= "Interface ID is not valid, only hex digits are allowed.";
        }       
        else
        {
            cf.ipv6_interface_id.value = cf.IPv6_interface_id1.value+":"+cf.IPv6_interface_id2.value+":"+cf.IPv6_interface_id3.value+":"+cf.IPv6_interface_id4.value;
        }
    }
    
    if (msg.length > 1)
    {
        alert(msg);
        return false;
    }
/*
    if(openvpnEnable == "enable"){
        alert("VPN Service does not work with an IPv6 Internet connection. If you want to use IPv6, you must disable the VPN Service first. (In the VPN Service screen, clear the Enable VPN Service check box and click the Apply button.)");
        return false;
    }
*/  

    parent.show_loading();
    
    return true;    
}

function loadSettings()
{
    var cf = document.forms[0];
    
    var ipv6rd_wan_dns_sel  = cf.ipv6rd_wan_dns_sel.value;
    var ipv6rd_wan_dns1_pri = cf.ipv6rd_wan_dns1_pri.value;
    var ipv6rd_wan_dns1_sec = cf.ipv6rd_wan_dns1_sec.value;
    var pri_dns = cf.ipv6rd_wan_dns1_pri.value.split(":");
    var sec_dns = cf.ipv6rd_wan_dns1_sec.value.split(":");

    var interface = document.forms[0].ipv6_interface_id.value.split(":");

    checkInterfaceID();
    
    if (cf.ipv6_interface_id.value != "")
    {
        cf.IPv6_interface_id1.value = interface[0];
        cf.IPv6_interface_id2.value = interface[1];
        cf.IPv6_interface_id3.value = interface[2];
        cf.IPv6_interface_id4.value = interface[3];
    }

    cf.DNSAssign[ipv6rd_wan_dns_sel].checked = true;
    setDNS();
    if (cf.ipv6rd_wan_dns1_pri.value != "")
    {
        cf.PDAddr1.value = pri_dns[0];
        cf.PDAddr2.value = pri_dns[1];
        cf.PDAddr3.value = pri_dns[2];
        cf.PDAddr4.value = pri_dns[3];
        cf.PDAddr5.value = pri_dns[4];
        cf.PDAddr6.value = pri_dns[5];
        cf.PDAddr7.value = pri_dns[6];
        cf.PDAddr8.value = pri_dns[7];
    }    

    if (cf.ipv6rd_wan_dns1_sec.value != "")
    {
        cf.SDAddr1.value = sec_dns[0];
        cf.SDAddr2.value = sec_dns[1];
        cf.SDAddr3.value = sec_dns[2];
        cf.SDAddr4.value = sec_dns[3];
        cf.SDAddr5.value = sec_dns[4];
        cf.SDAddr6.value = sec_dns[5];
        cf.SDAddr7.value = sec_dns[6];
        cf.SDAddr8.value = sec_dns[7];
    }

    parent.hide_loading();
}
</script>
</html>
